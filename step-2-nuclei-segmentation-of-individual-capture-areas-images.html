<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Step 2: Nuclei segmentation of individual capture areas images | VisiumLIBD: Visium Image Processing Pipeline</title>
  <meta name="description" content="2 Step 2: Nuclei segmentation of individual capture areas images | VisiumLIBD: Visium Image Processing Pipeline" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Step 2: Nuclei segmentation of individual capture areas images | VisiumLIBD: Visium Image Processing Pipeline" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="LieberInstitute/VisiumLIBD" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Step 2: Nuclei segmentation of individual capture areas images | VisiumLIBD: Visium Image Processing Pipeline" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"/>
<link rel="next" href="step-3-run-spaceranger.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li><a href="index.html#why-spatial-transcriptomics-or-visium-imaging">Why <code>spatial transcriptomics</code> or <code>visium imaging</code>??</a></li>
<li><a href="index.html#cite-visiumlibd">Cite <code>VisiumLIBD</code></a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#image-acquisition"><i class="fa fa-check"></i>Image Acquisition</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-requirements"><i class="fa fa-check"></i>Software Requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-availability"><i class="fa fa-check"></i>Data Availability</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"><a href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"><i class="fa fa-check"></i><b>1</b> Step 1: Split Visium histology whole slide image into individual capture area images</a></li>
<li class="chapter" data-level="2" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><i class="fa fa-check"></i><b>2</b> Step 2: Nuclei segmentation of individual capture areas images</a>
<ul>
<li class="chapter" data-level="2.1" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#vns---visium-nuclei-segmentation"><i class="fa fa-check"></i><b>2.1</b> <span>VNS</span> - Visium Nuclei Segmentation</a></li>
<li class="chapter" data-level="2.2" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#refinevns"><i class="fa fa-check"></i><b>2.2</b> <span>refineVNS</span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="step-3-run-spaceranger.html"><a href="step-3-run-spaceranger.html"><i class="fa fa-check"></i><b>3</b> Step 3: Run spaceranger</a></li>
<li class="chapter" data-level="4" data-path="step-4-spotspotcheck.html"><a href="step-4-spotspotcheck.html"><i class="fa fa-check"></i><b>4</b> Step 4: spotspotcheck</a></li>
<li class="chapter" data-level="5" data-path="step-5-atlasaligner.html"><a href="step-5-atlasaligner.html"><i class="fa fa-check"></i><b>5</b> Step 5: AtlasAligner</a></li>
<li class="chapter" data-level="" data-path="r-session-information.html"><a href="r-session-information.html"><i class="fa fa-check"></i>R session information</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">VisiumLIBD: Visium Image Processing Pipeline</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="step-2-nuclei-segmentation-of-individual-capture-areas-images" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Step 2: Nuclei segmentation of individual capture areas images</h1>
<p>The functions <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a>(Visium Nuclei Segmentation) and <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/refineVNS.m">refineVNS</a> from the pipeline are used to perform nuclei segmentation.</p>
<div id="vns---visium-nuclei-segmentation" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a> - Visium Nuclei Segmentation</h2>
<p>The inputs to the <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a> function are
1. The tif image of single capture area (output from Step 1: splitSlide function) with full path
2. number of colors a user visually identifies in the single capture area image</p>
<p>The <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a> function imports the capture area image, applies smoothening to it to get rid of any irregularities in the image and increases the contrast to brighten the nuclei for better detection.<br />
This function is based on <a href="https://www.mathworks.com/help/images/color-based-segmentation-using-k-means-clustering.html#:~:text=K%2Dmeans%20clustering%20requires%20that,*&#39;%20and%20&#39;b*&#39;%20values.">Color-Based Segmentation Using K-Means Clustering</a>. The smoothened and brightened image is converted from RGB color space to <code>CIELAB</code> color space also called <code>L*a*b</code> color space (L - Luminosity layer measures lightness from black to white, a - chromaticity-layer measures color along red-green axis, b - chromaticity-layer measures color along blue-yellow axis). The CIELAB color space quantifies the visual differences caused by the different colors in the image. The <code>a*b</code> color space is extracted from the <code>L*a*b</code> converted image and is given to the K-means clustering along with the number of colors the user visually identifies in the image.</p>
<p>The <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a> function partitions the image into n (number provided by user, 5 for the sample used here) color clusters and saves them as individual objects with a index/label. The color clusters (cell array), the indexed objects (cell array) of the color clusters, images of the color clusters (tif) are all saved in the same location as the capture area tif image.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb5-1"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="va">fname</span> <span class="op">=</span> <span class="ss">&#39;/path_to_capture_area_tif/Lieber_Institute_OTS-20-7690_rush_anterior_A1.tif&#39;</span><span class="op">;</span></span>
<span id="cb5-2"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">N</span> <span class="op">=</span> <span class="fl">5</span><span class="op">;</span> <span class="co">% 5 (white,pink,dark pink,cream,blue) colors seem good for the images produced in-house</span></span>
<span id="cb5-3"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">VNS</span>(<span class="va">fname</span><span class="op">,</span><span class="va">N</span>)</span>
<span id="cb5-5"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">% should add the output printed on matlab command prompt</span></span></code></pre></div>
<p>Below are the outputs of <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/VNS.m">VNS</a> function
1. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster1.tif</a>
2. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster2.tif</a>
3. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster3.tif</a>
4. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster4.tif</a>
5. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster5.tif</a>
6. <a href="link%20to%20AWS">Lieber_Institute_OTS-20-7690_rush_anterior_A1_cluster.mat</a>
7. <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/pipeline_outputs/VNS/Lieber_Institute_OTS-20-7690_rush_anterior_A1_mask.mat">Lieber_Institute_OTS-20-7690_rush_anterior_A1_mask.mat</a></p>
<p>The color clusters and the corresponding indexed objects of the sample image are shown below.
<img src="images/sampleimage.png" title="Sample capture area" /> <img src="images/indexedimage.png" title="Indexed object" /> <img src="images/index_label.png" title="Index labels" /> <img src="images/sampleimage_clust1.png" title="Color cluster 1" /> <img src="images/sampleimage_index1.png" title="Indexed object 1" /> <img src="images/sampleimage_clust2.png" title="Color cluster 2" /> <img src="images/sampleimage_index2.png" title="Indexed object 2" /> <img src="images/sampleimage_clust3.png" title="Color cluster 3" /> <img src="images/sampleimage_index3.png" title="Indexed object 3" /> <img src="images/sampleimage_clust4.png" title="Color cluster 4" /> <img src="images/sampleimage_index4.png" title="Indexed object 4" /> <img src="images/sampleimage_clust5.png" title="Color cluster 5" /> <img src="images/sampleimage_index5.png" title="Indexed object 5" /><br/></p>
</div>
<div id="refinevns" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> <a href="https://github.com/LieberInstitute/VisiumLIBD/blob/main/code/refineVNS.m">refineVNS</a></h2>
<p>This function is used to refine the segmentations for accurate detection of nuclei.</p>
<p>The inputs to the function are
1. The tif image of a single capture area with full path
2. The index of the color cluster of the nuclei</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb6-1"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">fname</span> <span class="op">=</span> <span class="ss">&#39;/path_to_capture_area_tif/Lieber_Institute_OTS-20-7748_rush_posterior_A1.tif&#39;</span><span class="op">;</span></span>
<span id="cb6-2"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">M</span> <span class="op">=</span> <span class="fl">3</span><span class="op">;</span></span>
<span id="cb6-3"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">refineVNS</span>(<span class="va">fname</span><span class="op">,</span><span class="va">N</span>)</span></code></pre></div>
<p>The color cluster before and after refining is shown below.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="step-3-run-spaceranger.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
