<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>VistoSeg: Visium Histology Image Segmentation and Processing Pipeline</title>
  <meta name="description" content="VistoSeg: Visium Histology Image Segmentation and Processing Pipeline" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="VistoSeg: Visium Histology Image Segmentation and Processing Pipeline" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="LieberInstitute/VistoSeg" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="VistoSeg: Visium Histology Image Segmentation and Processing Pipeline" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="icon_32.png" type="image/x-icon" />

<link rel="next" href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li><a href="index.html#why-spatial-transcriptomics-or-visium-imaging">Why <em>spatial transcriptomics</em> or <em>Visium imaging</em>?</a></li>
<li><a href="index.html#cite-vistoseg">Cite <code>VistoSeg</code></a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#image-acquisition"><i class="fa fa-check"></i>Image Acquisition</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-requirements"><i class="fa fa-check"></i>Software Requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-help"><i class="fa fa-check"></i>Getting Help</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-availability"><i class="fa fa-check"></i>Data Availability</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"><a href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html"><i class="fa fa-check"></i><b>1</b> Step 1: Split Visium histology whole slide image into individual capture area images</a></li>
<li class="chapter" data-level="2" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><i class="fa fa-check"></i><b>2</b> Step 2: Nuclei segmentation of individual capture areas images</a>
<ul>
<li class="chapter" data-level="2.1" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#vns---visium-nuclei-segmentation"><i class="fa fa-check"></i><b>2.1</b> VNS - Visium Nuclei Segmentation</a></li>
<li class="chapter" data-level="2.2" data-path="step-2-nuclei-segmentation-of-individual-capture-areas-images.html"><a href="step-2-nuclei-segmentation-of-individual-capture-areas-images.html#refinevns"><i class="fa fa-check"></i><b>2.2</b> refineVNS</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="step-3-spaceranger.html"><a href="step-3-spaceranger.html"><i class="fa fa-check"></i><b>3</b> Step 3: spaceranger</a>
<ul>
<li class="chapter" data-level="" data-path="step-3-spaceranger.html"><a href="step-3-spaceranger.html#what-is-spaceranger"><i class="fa fa-check"></i>What is spaceranger?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="step-4-gui-to-count-nuclei-in-a-visium-spot.html"><a href="step-4-gui-to-count-nuclei-in-a-visium-spot.html"><i class="fa fa-check"></i><b>4</b> Step 4: GUI to count nuclei in a Visium spot</a>
<ul>
<li class="chapter" data-level="4.1" data-path="step-4-gui-to-count-nuclei-in-a-visium-spot.html"><a href="step-4-gui-to-count-nuclei-in-a-visium-spot.html#spotspotcheck"><i class="fa fa-check"></i><b>4.1</b> spotspotcheck</a></li>
<li class="chapter" data-level="4.2" data-path="step-4-gui-to-count-nuclei-in-a-visium-spot.html"><a href="step-4-gui-to-count-nuclei-in-a-visium-spot.html#countnuclei"><i class="fa fa-check"></i><b>4.2</b> countNuclei</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="step-5-test-data-and-future-directions.html"><a href="step-5-test-data-and-future-directions.html"><i class="fa fa-check"></i><b>5</b> Step 5: Test data and future directions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="step-5-test-data-and-future-directions.html"><a href="step-5-test-data-and-future-directions.html#public-datasets"><i class="fa fa-check"></i><b>5.1</b> Public datasets</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="step-5-test-data-and-future-directions.html"><a href="step-5-test-data-and-future-directions.html#heart-tissue"><i class="fa fa-check"></i><b>5.1.1</b> Heart Tissue</a></li>
<li class="chapter" data-level="5.1.2" data-path="step-5-test-data-and-future-directions.html"><a href="step-5-test-data-and-future-directions.html#breast-tissue"><i class="fa fa-check"></i><b>5.1.2</b> Breast Tissue</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="step-5-test-data-and-future-directions.html"><a href="step-5-test-data-and-future-directions.html#future-directions"><i class="fa fa-check"></i><b>5.2</b> Future directions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-session-information.html"><a href="r-session-information.html"><i class="fa fa-check"></i>R session information</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">VistoSeg: Visium Histology Image Segmentation and Processing Pipeline</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">VistoSeg: Visium Histology Image Segmentation and Processing Pipeline</h1>
<p class="author"><em>Madhavi Tippani</em></p>
<address class="author_afil">
Lieber Institute for Brain Development, Johns Hopkins Medical Campus<br><a class="author_email" href="mailto:#"><a href="mailto:madhavi.tippani@libd.org" class="email">madhavi.tippani@libd.org</a></a>
</address>
</div>
<div id="overview" class="section level1 unnumbered">
<h1>Overview</h1>
Histological imaging is a critical first step of the <strong>spatial transcriptomics</strong> workflow, a barcoding-based transcriptome-wide technology released by <a href="https://www.10xgenomics.com">10x Genomics</a>.
<center>
<img src="images/visium_imaging.png" />
</center>
<center>
<img src="images/visium_spot.png" />
</center>
<div id="why-spatial-transcriptomics-or-visium-imaging" class="section level2 unnumbered">
<h2>Why <em>spatial transcriptomics</em> or <em>Visium imaging</em>?</h2>
<p>Methods like single-nucleus and single cell RNA-sequencing (RNA-seq) can profile single cells transcriptome-wide enabling researchers to identify cell type compositions; however, these methods necessarily destroy information about spatial positioning. On the other hand, multiplexing and in situ sequencing methods can provide spatial information, but have significant limitations on the number of genes that can be processed as well as issues with microscopy and related computational challenges. <strong>Spatial transcriptomics</strong>, including the 10X Genomics Visium platform, provides solutions to these limitations by allowing researchers to quantify gene expression with high spatial resolution. A critical component for the 10X Genomics platform to provide spatial context is the <strong>Visium imaging</strong> of the <a href="https://www.10xgenomics.com/products/spatial-gene-expression">Visium gene expression slide</a>. On this slide, the experimental tissue sections that are being analyzed are mounted onto the <strong>capture areas (A1,B1,C1,D1)</strong> located on the slide. The whole slide is then imaged, producing a large output image file that contains all of the capture areas. This image of the whole slide then has to be subsequently split into individual capture area images (necessarily JPEG or tif), which are then processed accordingly for the downstream gene expression analyses.</p>
<p>This website describes the steps required to split, visualize and process the Visium images from spatial transcriptomics projects generated by the <a href="https://www.10xgenomics.com/spatial-transcriptomics">10x Genomics Visium</a> commercial platform.

<img src="images/VistoSeg.png" />
The above figure describes the <strong><code>VistoSeg</code> pipeline</strong>, <strong>(A)</strong> The data presented here is from tissue sections obtained from three levels of the human dorsolateral prefrontal cortex (DLPFC; posterior, middle and anterior). Each tissue section spans the six cortical layers plus the white matter. <strong>(B)</strong> Shows the original <em>‘Visium gene expression slide’</em> with 4 capture areas, and the slide scanner used to image the slide. <strong>(C)</strong> Shows the large tif file produced by the slide scanner, which is then split into the respective capture areas using the function <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/code/split.m">splitSlide</a> described in <a href="http://research.libd.org/VistoSeg/step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html">Step 1</a>. <strong>(D)</strong> Shows the individual tif images of capture areas produced by <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/code/split.m">splitSlide</a>, and the corresponding nuclei segmentations produced by the functions <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/code/VNS.m">VNS</a> (Visium Nuclei Segmentation) and <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/code/refineVNS.m">refineVNS</a> explained in <a href="http://research.libd.org/VistoSeg/step-2-nuclei-segmentation-of-individual-capture-areas-images.html">Step 2</a>. <strong>(E)</strong> The tif images from <em>‘(D)’</em> serve as input to the <a href="https://support.10xgenomics.com/spatial-gene-expression/software/pipelines/latest/using/count">Spaceranger</a> module (explained in <a href="https://research.libd.org/VistoSeg/step-3-spaceranger.html">Step 3</a>), which generates <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/pipeline_outputs/spaceranger/tissue_positions_list.csv">tissue_positions_list.csv</a> file and <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/pipeline_outputs/spaceranger/scalefactors_json.json">scalefactors_json.json</a> file that contain <em>‘Visium spot metrics’</em>. <strong>(F)</strong> The function <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/code/countNuclei.m">countNuclei</a> explained in <a href="https://research.libd.org/VistoSeg/step-4-gui-to-count-nuclei-in-a-visium-spot.html">Step 4</a>, gives the nuclei count per Visium spot info that is stored in <a href="https://github.com/LieberInstitute/VistoSeg/blob/main/pipeline_outputs/spotspotcheck/tissue_spot_counts.csv">tissue_spot_counts.csv</a> file. <strong>(G)</strong> Finally, the pipeline provides a GUI called <a href="https://research.libd.org/VistoSeg/step-4-gui-to-count-nuclei-in-a-visium-spot.html#spotspotcheck">spotspotcheck</a> that allows the user to perform visual inspection of the nuclei segmentations by allowing the user to toggle between the Visium and binary images, and also provides zoom in/out options to clearly identify cell bodies within a Visium spot.</p>
</div>
<div id="cite-vistoseg" class="section level2 unnumbered">
<h2>Cite <code>VistoSeg</code></h2>
<p>We hope that <a href="http://research.libd.org/VistoSeg/"><code>VistoSeg</code></a> will be useful for your research. Please use the following information to cite the package and the overall approach. Thank you!</p>
<pre><code>@article {Tippani2021,
    author = {Tippani, Madhavi and Divecha, Heena R. and Catallini II,
        Joseph L. and Kwon, Sang Ho and Weber, Lukas M. and Spangler, Abby and Jaffe,
        Andrew E. and Hicks, Stephanie C. and Martinowich, Keri and
        Collado-Torres, Leonardo and Page, Stephanie C. and Maynard,
        Kristen R.},
    title = {VistoSeg: processing utilities for high-resolution Visium/Visium-IF 
    images for spatial transcriptomics data},
    year = {2021},
    doi = {TODO},
    publisher = {TODO},
    URL = {TODO},
    journal = {bioRxiv}
}</code></pre>
Project lead: <a href="https://twitter.com/MadhaviTippani">Madhavi Tippani</a>, Staff Scientist in the <strong>Imaging Development Group</strong> at the <a href="https://www.libd.org/">Lieber Institute for Brain Development</a>.
<center>
<img src="http://lcolladotor.github.io/img/LIBD_logo.jpg" width="250px">
</center>
<p>Initial versions of <code>spotspotcheck</code> and <code>countNuclei</code> were developed by <a href="https://www.linkedin.com/in/joseph-catallini-ii/">Joseph L. Catallini II</a>.</p>
</div>
<div id="image-acquisition" class="section level2 unnumbered">
<h2>Image Acquisition</h2>
<p>The 10X <a href="https://support.10xgenomics.com/spatial-gene-expression/imaging/doc/technical-note-visium-spatial-gene-expression-imaging-guidelines">Visium Spatial Gene Expression Imaging Guidelines</a> are followed for acquiring the images. Images are acquired at 40x magnification using a Leica CS2 slide scanner and saved as <em>‘.SVS files.’</em> These <em>‘.SVS files’</em> are then exported as <em>‘TIF files’</em> for downstream analysis. The entire Visium slide (4 capture areas with fiducial frames), is scanned in a single file (~20GB).</p>
</div>
<div id="software-requirements" class="section level2 unnumbered">
<h2>Software Requirements</h2>
The pipeline was developed under the following software configuration.
<center>
<img src="images/Software_Configuration.png" />
</center>
<p><code>VistoSeg</code> has been tested on Linux, Windows and MacOS.</p>
<ol style="list-style-type: decimal">
<li><p><code>MATLAB</code><br />
MATLAB version R2019a 64-bit or later is required to run the <code>VistoSeg</code> pipeline with the <a href="https://www.mathworks.com/products/image.html">Image Processing Toolbox</a> preloaded.</p></li>
<li><p><code>Memory</code><br />
Visium whole slide images are high resolution, and the typical size of these multiplane tif images produced in-house is ~25GB. The system RAM (we use ~75GB) should be thrice the size of the multiplane tif image to load it into MATLAB and split them into individual capture areas. The rest of the processing, on individual capture tifs can be performed on a system with as little as 16GB of RAM.</p></li>
<li><p><code>Installation</code><br />
The pipeline is available at <a href="https://github.com/LieberInstitute/VistoSeg" class="uri">https://github.com/LieberInstitute/VistoSeg</a>, which can be download to your system from the Github website directly or the main repository can be cloned to your system using the following command on terminal/command prompt.</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="index.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/LieberInstitute/VistoSeg.git</span></code></pre></div>
<p>All the code exists in the <a href="https://github.com/LieberInstitute/VistoSeg/tree/main/code">code</a> directory inside the main <a href="https://github.com/LieberInstitute/VistoSeg"><code>VistoSeg</code></a> directory.
The user’s working directory on MATLAB should be the path to the <a href="https://github.com/LieberInstitute/VistoSeg/tree/main/code">code</a> directory in the downloaded repository, to run any functions this pipeline provides. Once the repository is downloaded, the user can run either of the following code to change their working directory on MATLAB to the <a href="https://github.com/LieberInstitute/VistoSeg/tree/main/code">code</a> directory.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="index.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /path_to_the_downloaded_repository/VistoSeg/code/</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb4-1"><a href="index.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">addpath</span>(<span class="va">genpath</span>(<span class="ss">&#39;/path_to_the_downloaded_repository/VistoSeg/code/&#39;</span>))</span></code></pre></div>
</div>
<div id="getting-help" class="section level2 unnumbered">
<h2>Getting Help</h2>
<p>If you are using <code>VistoSeg</code> and are running into unexpected problems, please <a href="https://github.com/LieberInstitute/VistoSeg/issues">report them</a> publicly such that other users might benefit from the answers. Thank you!</p>
</div>
<div id="data-availability" class="section level2 unnumbered">
<h2>Data Availability</h2>
<p>The raw Visium <code>.tif</code> file is available at through <a href="https://visium-libd.s3.amazonaws.com/Lieber_Institute_OTS-20-7690_rush_anterior.tif">AWS</a>.</p>
<p><strong>Other potential datasets</strong><br />
1. <a href="https://github.com/LieberInstitute/spatialLIBD#raw-data">LIBD pilot DLPFC</a><br />
2. <a href="https://support.10xgenomics.com/spatial-gene-expression/datasets">10x Genomics spatial data sets</a><br />
3. All input files and output files for the samples images used in every step in the pipeline are provided at the end of the section.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="step-1-split-visium-histology-whole-slide-image-into-individual-capture-area-images.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
